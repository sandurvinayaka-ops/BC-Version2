<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birth Pulse - Cinematic TV Pro V30</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body, html {
            margin: 0; padding: 0; width: 100vw; height: 100vh;
            overflow: hidden; background-color: #000000;
            font-family: Arial, Helvetica, sans-serif; color: white;
            cursor: grab;
        }
        body:active { cursor: grabbing; }

        /* 1. BACKGROUND STARS */
        .stars-container {
            position: absolute; width: 100%; height: 100%;
            z-index: 1; pointer-events: none;
        }
        .star {
            position: absolute; background: white; border-radius: 50%;
            animation: blink var(--t) infinite ease-in-out;
        }
        @keyframes blink { 0%, 100% { opacity: 0.1; transform: scale(0.8); } 50% { opacity: 0.8; transform: scale(1.1); } }

        /* 2. UI LAYOUT */
        .ui-overlay {
            position: relative; z-index: 10; pointer-events: none;
            height: 100vh; padding: 6vh 6vw;
        }

        .main-heading {
            position: absolute; top: 7vh; left: 6vw;
            font-size: 3.1vw; color: #a855f7; 
            font-weight: 800; z-index: 110;
            text-shadow: 0 0 30px rgba(168, 85, 247, 0.6);
        }

        .stats-panel { 
            position: absolute; top: 50%; left: 6vw; 
            transform: translateY(-50%); width: 32vw; z-index: 100;
        }

        .label { 
            font-size: 1.3vw; color: #38bdf8; 
            text-transform: uppercase; font-weight: 900; 
            letter-spacing: 3px; margin-bottom: 5px;
        }

        .count {
            font-size: 8.2vw; font-weight: 900; color: #fbbf24;
            line-height: 1.1; margin: 0; 
            text-shadow: 0 0 30px rgba(250, 204, 21, 0.4);
        }
        
        .progress-container { width: 100%; margin-top: 40px; }
        .top-labels { display: flex; justify-content: space-between; width: 100%; margin-bottom: 8px; }
        .limit-text { color: #38bdf8; font-size: 1.1vw; font-weight: bold; opacity: 0.8; letter-spacing: 1px; }
        
        .bar-wrapper { 
            width: 100%; height: 16px; background: rgba(255,255,255,0.05); 
            border-radius: 10px; border: 1px solid rgba(255,255,255,0.15);
            overflow: hidden; position: relative;
        }
        .bar-fill { 
            height: 100%; width: 0%; 
            background: linear-gradient(90deg, #f59e0b, #fbbf24); 
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); 
        }

        .bottom-clock { width: 100%; text-align: center; margin-top: 15px; }
        #clock { color: #fbbf24; font-size: 1.8vw; font-weight: bold; letter-spacing: 3px; }

        /* 3. GLOBE POSITIONING */
        .globe-container {
            position: absolute; left: 0; top: 0; width: 100vw; height: 100vh; z-index: 5;
        }
        #main-canvas { width: 100%; height: 100%; }

        #loading {
            position: absolute; width: 100%; height: 100%;
            background: #000000; display: flex; align-items: center; 
            justify-content: center; z-index: 2000; color: #38bdf8; font-size: 2.5vw;
        }
    </style>
</head>
<body>

    <div id="loading">SYNCING RADIUM SYSTEMS...</div>
    <div class="stars-container" id="starfield"></div>

    <div class="globe-container">
        <canvas id="main-canvas"></canvas>
    </div>

    <div class="ui-overlay">
        <h1 class="main-heading">Mother & Child Care-Women's Health</h1>

        <div class="stats-panel">
            <span class="label">Global Birth Count Today</span>
            <div id="birthCount" class="count">0</div>
            
            <div class="progress-container">
                <div class="top-labels">
                    <span class="limit-text">00:00</span>
                    <span class="limit-text">24:00</span>
                </div>
                <div class="bar-wrapper">
                    <div id="bar" class="bar-fill"></div>
                </div>
                <div class="bottom-clock">
                    <span id="clock">00:00:00</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // TV-SAFE ES5 CODE
        var BIRTH_RATE = 4.34;
        var AUTO_ROTATION_SPEED = 0.42; 
        var PACIFIER_PATH = "M12,2A5,5,0,0,0,7,7v2c-2,0-3,1-3,3s1,3,3,3v2a5,5,0,0,0,10,0V15c2,0,3-1,3-3s-1-3-3-3V7A5,5,0,0,0,12,2Zm3,7H9V7a3,3,0,0,1,6,0Zm0,9a3,3,0,0,1-6,0V17h6Z";
        
        var globeThemes = [
            { land: "#4ade80", oCore: "#1e3a8a", oEdge: "#0f172a" }, // Emerald
            { land: "#fb7185", oCore: "#4c0519", oEdge: "#1a0105" }, // Rose
            { land: "#22d3ee", oCore: "#0e7490", oEdge: "#083344" }, // Cyan
            { land: "#facc15", oCore: "#713f12", oEdge: "#422006" }  // Amber
        ];
        var currentThemeIdx = 0;
        
        var worldData = null;
        var flashingISO = {}; 
        var floaters = [];
        var stars = [];
        var comets = [];

        var canvas = document.getElementById("main-canvas");
        var context = canvas.getContext("2d");
        var w, h;

        var isDragging = false;
        var lastMouseX, lastMouseY;
        var rotX = 0, rotY = -15;

        function setSizes() {
            w = window.innerWidth; h = window.innerHeight;
            canvas.width = w; canvas.height = h;
        }
        setSizes();

        var projection = d3.geoOrthographic()
            .scale(h / 2.8)
            .translate([w * 0.72, h * 0.5]) 
            .clipAngle(90);

        var path = d3.geoPath(projection, context);

        canvas.addEventListener('mousedown', function(e) { isDragging = true; lastMouseX = e.clientX; lastMouseY = e.clientY; });
        window.addEventListener('mousemove', function(e) {
            if (!isDragging) return;
            rotX += (e.clientX - lastMouseX) * 0.3;
            rotY -= (e.clientY - lastMouseY) * 0.3;
            lastMouseX = e.clientX; lastMouseY = e.clientY;
        });
        window.addEventListener('mouseup', function() { isDragging = false; });

        for(var i=0; i<100; i++) {
            stars.push({ x: Math.random()*w, y: Math.random()*h, sz: Math.random()*2, t: 2 + Math.random()*3 });
        }
        for(var i=0; i<5; i++) {
            floaters.push({
                x: Math.random()*w, y: Math.random()*h,
                vx: (Math.random()-0.5)*0.15, vy: (Math.random()-0.5)*0.15,
                rot: Math.random()*360, rSpeed: (Math.random()-0.5)*1, phase: Math.random()*5
            });
        }

        setInterval(function() { currentThemeIdx = (currentThemeIdx + 1) % globeThemes.length; }, 180000);

        function init() {
            d3.json("https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson").then(function(data) {
                worldData = data;
                document.getElementById('loading').style.display = 'none';
                renderLoop();
                startSimulation();
            });
        }

        function renderLoop() {
            if (!isDragging) rotX += AUTO_ROTATION_SPEED;
            projection.rotate([rotX, rotY]);
            context.clearRect(0, 0, w, h);

            // 1. Stars
            context.fillStyle = "white";
            var timeNow = Date.now() * 0.001;
            for(var i=0; i<stars.length; i++) {
                var s = stars[i];
                context.globalAlpha = 0.2 + Math.abs(Math.sin(timeNow / s.t)) * 0.6;
                context.beginPath(); context.arc(s.x, s.y, s.sz, 0, 7); context.fill();
            }
            context.globalAlpha = 1;

            // 2. Realistic Comets
            drawRealisticComets();

            // 3. Realistic 3D Pacifiers with Pulsing Radium Centre
            drawPulsingPacifiers();

            var center = projection.translate();
            var radius = projection.scale();
            var theme = globeThemes[currentThemeIdx];

            // 4. IMPROVED ATMOSPHERE
            var atmosphere = context.createRadialGradient(center[0], center[1], radius, center[0], center[1], radius + 55);
            atmosphere.addColorStop(0, "rgba(56, 189, 248, 0.25)");
            atmosphere.addColorStop(0.5, "rgba(168, 85, 247, 0.1)");
            atmosphere.addColorStop(1, "transparent");
            context.beginPath(); context.arc(center[0], center[1], radius + 55, 0, 7);
            context.fillStyle = atmosphere; context.fill();

            // 5. Ocean
            var oceanGrad = context.createRadialGradient(center[0]-radius/2.5, center[1]-radius/2.5, radius/20, center[0], center[1], radius);
            oceanGrad.addColorStop(0, "#3b82f6"); 
            oceanGrad.addColorStop(0.4, theme.oCore);
            oceanGrad.addColorStop(1, theme.oEdge);
            context.beginPath(); context.arc(center[0], center[1], radius, 0, 7);
            context.fillStyle = oceanGrad; context.fill();

            // 6. Countries
            if (worldData) {
                var now = Date.now();
                var currentLand = theme.land;
                var flashColor = (currentLand === "#facc15") ? "#ffffff" : "#fbbf24";

                worldData.features.forEach(function(feature) {
                    var iso = feature.properties.ISO_A3 || feature.properties.ADM0_A3;
                    context.beginPath(); path(feature);
                    if (flashingISO[iso] && (now - flashingISO[iso] < 2000)) {
                        context.fillStyle = flashColor; 
                    } else {
                        context.fillStyle = currentLand; 
                    }
                    context.fill();
                    context.strokeStyle = "rgba(255, 255, 255, 0.4)";
                    context.lineWidth = 0.7; context.stroke();
                });
            }
            requestAnimationFrame(renderLoop);
        }

        function drawPulsingPacifiers() {
            var time = Date.now() * 0.001;
            // Pulsing factor (0.2 to 1.0)
            var pulse = 0.6 + Math.sin(time * 3) * 0.4;

            for (var i = 0; i < floaters.length; i++) {
                var f = floaters[i];
                f.x += f.vx; f.y += f.vy; f.rot += f.rSpeed;
                if(f.x < -100) f.x = w + 100; if(f.x > w + 100) f.x = -100;
                if(f.y < -100) f.y = h + 100; if(f.y > h + 100) f.y = -100;

                var bob = Math.sin(time + f.phase) * 8;
                context.save();
                context.translate(f.x, f.y + bob);
                context.rotate(f.rot * Math.PI / 180);
                context.scale(0.35, 0.35); 

                // 1. Butterfly Shield Wings
                var wingGrad = context.createLinearGradient(-50, -40, 50, 40);
                wingGrad.addColorStop(0, "#bae6fd"); wingGrad.addColorStop(1, "#fb923c");
                context.beginPath();
                context.moveTo(-35, -20);
                context.bezierCurveTo(-60, -50, -60, 50, -35, 20);
                context.bezierCurveTo(-15, 15, 15, 15, 35, 20);
                context.bezierCurveTo(60, 50, 60, -50, 35, -20);
                context.bezierCurveTo(15, -15, -15, -15, -35, -20);
                context.fillStyle = wingGrad; context.fill();

                // 2. RADIUM CENTRE PULSE
                context.shadowBlur = 40 * pulse; 
                context.shadowColor = "#ccff00";

                var domeGrad = context.createRadialGradient(-5, -5, 2, 0, 0, 22);
                domeGrad.addColorStop(0, "#ffffff"); 
                domeGrad.addColorStop(1, "rgba(204, 255, 0, " + pulse + ")"); // Radium pulse
                
                context.beginPath(); context.arc(0, 0, 22, 0, 7);
                context.fillStyle = domeGrad; context.fill();

                // 3. Handle
                context.shadowBlur = 0;
                context.beginPath(); context.arc(0, 32, 20, 0, 7);
                context.strokeStyle = "rgba(255,255,255,0.9)"; context.lineWidth = 6; context.stroke();

                context.restore();
            }
        }

        function drawRealisticComets() {
            if (Math.random() > 0.996) comets.push({ x: Math.random()*w, y: -100, vx: -18, vy: 14, life: 1 });
            for (var i = 0; i < comets.length; i++) {
                var c = comets[i];
                var g = context.createLinearGradient(c.x, c.y, c.x + 200, c.y - 150);
                g.addColorStop(0, "white");
                g.addColorStop(0.1, "rgba(255, 255, 255, 0.8)");
                g.addColorStop(0.5, "rgba(168, 85, 247, 0.4)");
                g.addColorStop(1, "transparent");
                context.strokeStyle = g; context.lineWidth = 5; context.lineCap = "round";
                context.beginPath(); context.moveTo(c.x, c.y); context.lineTo(c.x + 220, c.y - 170); context.stroke();
                context.fillStyle = "white";
                context.beginPath(); context.arc(c.x, c.y, 3, 0, 7); context.fill();
                c.x += c.vx; c.y += c.vy; c.life -= 0.008;
                if(c.life <= 0) { comets.splice(i, 1); i--; }
            }
        }

        function startSimulation() {
            setInterval(function() {
                var now = new Date();
                var start = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
                var elapsed = (Date.now() - start) / 1000;
                var total = Math.floor(elapsed * BIRTH_RATE);
                document.getElementById('birthCount').innerText = total.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                document.getElementById('clock').innerText = now.toLocaleTimeString('en-GB');
                
                var pVal = (elapsed / 86400 * 100).toFixed(1);
                document.getElementById('bar').style.width = pVal + "%";

                if (worldData) {
                    var idx = Math.floor(Math.random() * worldData.features.length);
                    var iso = worldData.features[idx].properties.ISO_A3 || worldData.features[idx].properties.ADM0_A3;
                    flashingISO[iso] = Date.now();
                }
            }, 1000 / BIRTH_RATE);
        }

        window.onresize = setSizes;
        init();
    </script>
</body>
</html>